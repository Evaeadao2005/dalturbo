<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atendimento Dalmon</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        #chat-box {
            max-width: 600px;
            width: 100%;
            margin: 20px auto;
            padding: 10px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            max-height: 500px;
        }
        .message {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 10px;
            max-width: 80%;
        }
        .bot {
            background-color: #e0e0e0;
            text-align: left;
        }
        .user {
            background-color: #4caf50;
            color: white;
            text-align: right;
        }
        .typing {
            background-color: #f1f1f1;
            text-align: center;
            font-style: italic;
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        .plan-button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .plan-button:hover {
            background-color: #0056b3;
        }
        .whatsapp-button-container {
            text-align: center;
            margin-top: 20px;
        }
        .whatsapp-button {
            padding: 10px 20px;
            background-color: #25d366;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            font-size: 16px;
        }
        .whatsapp-button:hover {
            background-color: #128c7e;
        }
        .input-container {
            display: flex;
            justify-content: space-between;
            padding: 10px;
        }
        .input-container input {
            width: 90%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .input-container button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .input-container button:hover {
            background-color: #0056b3;
        }
        .send-icon {
            width: 20px;
            height: 20px;
            background-image: url('https://img.icons8.com/ios-filled/50/ffffff/sent.png');
            background-size: contain;
            background-repeat: no-repeat;
            border: none;
            cursor: pointer;
        }
        .input-container button img {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>

    <div id="chat-box"></div>
    <div class="input-container">
        <input type="text" id="user-input" placeholder="Digite sua mensagem..." />
        <button class="send-icon" onclick="sendMessage()"></button>
    </div>

    <script>
        let step = 0;
        let userName = "";
        let userDevice = "";
        let userPlan = "";
        let userTVBrand = "";
        let discountPrice = 0;

        const chatBox = document.getElementById("chat-box");

        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return "Bom dia";
            if (hour < 18) return "Boa tarde";
            return "Boa noite";
        }

        function addTypingMessage(message, sender, callback) {
            const typingIndicator = document.createElement("div");
            typingIndicator.classList.add("message", "bot", "typing");
            typingIndicator.textContent = "Digitando...";
            chatBox.appendChild(typingIndicator);
            chatBox.scrollTop = chatBox.scrollHeight;

            setTimeout(() => {
                chatBox.removeChild(typingIndicator);
                addMessage(message, sender);
                if (callback) callback();
            }, 1000 + Math.random() * 1000);
        }

        function addMessage(message, sender) {
            const msgDiv = document.createElement("div");
            msgDiv.classList.add("message", sender);
            msgDiv.textContent = message;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById("user-input");
            const userInput = input.value.trim();
            if (!userInput) return;

            addMessage(userInput, "user");
            input.value = "";

            processBotResponse(userInput);
        }

        function processBotResponse(userInput) {
            if (step === 0) {
                userName = userInput;
                addTypingMessage(`${getGreeting()}, ${userName}, qual dispositivo você usará? (Ex: Celular Android, iPhone, TV Smart, etc.)`, "bot");
                step++;
            } else if (step === 1) {
                userDevice = userInput.toLowerCase();
                if (userDevice.includes("tv") && !userDevice.includes("box")) {
                    addTypingMessage("Qual a marca da sua TV?", "bot");
                    step++;
                } else {
                    showPlanOptions();
                }
            } else if (step === 2) {
                userTVBrand = userInput;
                addTypingMessage(`Você informou que o dispositivo é uma TV ${userTVBrand}. Agora, escolha o plano desejado.`, "bot");
                showPlanOptions();
            }
        }

        function showPlanOptions() {
            addTypingMessage("Escolha o plano desejado para assinar após o teste. Aproveite o desconto de R$ 5 na primeira compra!", "bot", () => {
                const plans = [
                    { name: "Mensal (1 mês): R$ 19,90", id: "mensal", price: 19.90 },
                    { name: "Trimestral (3 meses): R$ 49,90", id: "trimestral", price: 49.90 },
                    { name: "Semestral (6 meses): R$ 89,90", id: "semestral", price: 89.90 },
                ];
                const buttonContainer = document.createElement("div");
                buttonContainer.classList.add("button-container");
                plans.forEach(plan => {
                    const planButton = document.createElement("button");
                    planButton.classList.add("plan-button");
                    planButton.textContent = plan.name;
                    planButton.onclick = () => {
                        userPlan = plan.name;
                        discountPrice = plan.price - 5; // Desconto de R$5
                        addMessage(`Você escolheu o plano: ${userPlan}.`, "bot");
                        addMessage(`O valor com desconto será de R$ ${discountPrice.toFixed(2)}. Para finalizar, clique no botão abaixo para seguir para o WhatsApp.`, "bot");
                        showWhatsAppButton();
                    };
                    buttonContainer.appendChild(planButton);
                });
                chatBox.appendChild(buttonContainer);
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        function showWhatsAppButton() {
            const whatsappButtonContainer = document.createElement("div");
            whatsappButtonContainer.classList.add("whatsapp-button-container");

            // Inserir a saudação antes da mensagem
            const greeting = getGreeting();
            const message = `${greeting}, Olá, estou interessado no plano de ${userPlan} com o valor de R$ ${discountPrice.toFixed(2)} após o desconto.`;

            const whatsappButton = document.createElement("a");
            whatsappButton.href = `https://wa.me/5583990000000?text=${encodeURIComponent(message)}`;
            whatsappButton.classList.add("whatsapp-button");
            whatsappButton.textContent = "Finalizar no WhatsApp";
            whatsappButtonContainer.appendChild(whatsappButton);
            chatBox.appendChild(whatsappButtonContainer);
        }

        // Inicia o fluxo com saudação
        addMessage(`${getGreeting()}, Olá, eu sou o Atendente Dalmon. Como posso te ajudar hoje?`, "bot");
    </script>

</body>
</html>
